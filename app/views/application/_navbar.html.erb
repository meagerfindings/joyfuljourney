<nav class="navbar navbar-expand-lg navbar-dark bg-primary shadow-sm" data-turbo-permanent>
  <div class="container">
    <%= link_to "Joyful Journey", root_path, class: "navbar-brand fw-bold" %>
    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mainNav">
      <span class="navbar-toggler-icon"></span>
    </button>
    
    <div class="collapse navbar-collapse" id="mainNav">
      <ul class="navbar-nav me-auto">
        <li class="nav-item">
          <%= link_to "Posts", posts_path, class: "nav-link", data: { turbo_frame: "_top" } %>
        </li>
        <li class="nav-item">
          <%= link_to "Families", families_path, class: "nav-link", data: { turbo_frame: "_top" } %>
        </li>
        <li class="nav-item">
          <%= link_to "Milestones", milestones_path, class: "nav-link", data: { turbo_frame: "_top" } %>
        </li>
        <li class="nav-item">
          <%= link_to "Timeline", timeline_index_path, class: "nav-link", data: { turbo_frame: "_top" } %>
        </li>
        <li class="nav-item">
          <%= link_to "Activity", activities_path, class: "nav-link", data: { turbo_frame: "_top" } %>
        </li>
      </ul>
      
      <ul class="navbar-nav">
        <% if current_user %>
          <!-- Notifications Bell -->
          <li class="nav-item me-2">
            <%= link_to notifications_path, class: "nav-link position-relative", title: "Notifications" do %>
              <i class="bi bi-bell fs-5"></i>
              <% if current_user.unread_notifications_count > 0 %>
                <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">
                  <%= current_user.unread_notifications_count > 9 ? "9+" : current_user.unread_notifications_count %>
                  <span class="visually-hidden">unread notifications</span>
                </span>
              <% end %>
            <% end %>
          </li>
          
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
              <%= current_user.first_name || current_user.username %>
            </a>
            <ul class="dropdown-menu">
              <li><%= link_to "Profile", user_path(current_user), class: "dropdown-item" %></li>
              <li><%= link_to "My Posts", user_posts_path(current_user), class: "dropdown-item" %></li>
              <li><%= link_to "Notifications", notifications_path, class: "dropdown-item" %></li>
              <li><hr class="dropdown-divider"></li>
              <li><%= link_to "Log Out", logout_path, method: :post, class: "dropdown-item", data: { turbo_method: :post } %></li>
            </ul>
          </li>
        <% else %>
          <li class="nav-item">
            <%= link_to "Sign Up", "#{new_user_path}?claimed=true", class: "nav-link" %>
          </li>
          <li class="nav-item">
            <%= link_to "Log In", login_path, class: "btn btn-outline-light ms-2" %>
          </li>
        <% end %>
      </ul>
    </div>
  </div>
</nav>
